---
title: 前端面试 JS部分 作用域和闭包 
date: 2017-07-05 19:15:03
tags: 
- JS
categories: [JS]
---
<p></p>
<!-- more -->
## 基础知识 ##

### 作用域和闭包 ###


*知识点*

** 执行上下文 **

示例代码如下:
```javascript
console.log(a);//undefined
var a = 100;

fn('zhangsan');// 'zhangsan' 20
function fn(name){
  age = 20;
  console.log(name,age);
  var age;
}
```

范围: 一段&lt;script>　或者一个函数
全局执行上下文: 变量定义，函数声明(针对一段&lt;script>来说，执行之前将这两
个拿出来)
函数执行上下文: 变量定义，函数声明，this, arguments(针对函数来说，执行之前将这
几个拿出来)


** this **
_this要在执行时才能确认值，定义时无法确认_

执行的几个场景:

*  作为构造函数执行
*  作为对象属性执行
*  作为普通函数执行
*  call apply bind

示例代码:
```javascript
var a = {
  name: 'A',
  fn: function(){
    console.log(this.name);
  }
}

a.fn(); //this === a 
a.fn.call({name: 'B'});//this === {name:'B'}
var fn1 = a.fn;
fn1() //this === window
```


** 作用域 **

*  es5中JS没有块级作用域
*  JS有全局作用域和局部作用域

** 作用域链 ** 

示例代码 
```javascript
var a = 100
function fn() {
  var b = 200;
  //当前作用域没有定义的变量，即"自由变量"
  console.log(a);//fn执行时，在当前函数作用域中找不到a,于是需要去它的上级作用
  //域即全局作用域中寻找a
  console.log(b);
}
fn();
```

__函数的父级作用域指的是函数定义时的父级作用域，而不是函数执行时的父级作用域__

作用域链即形容寻找自由变量时，不断的往它的父级作用域上找，而形成的一种链式结构


** 闭包 ** 

示例代码:
```javascript
function F1(){
  var a = 100
  //返回一个函数(函数作为返回值)
  return function() {
    console.log(a)
  }
}

//f1得到一个函数
var f1 = F1()
var a = 200
f1()//100
```

```javascript
function F1(){
  var a = 100
  //返回一个函数(函数作为返回值)
  return function() {
    console.log(a)
  }
}

//f1得到一个函数
var f1 = F1()

function F2(fn){
  var a = 200
  fn()
}
F2(f1);//100
```

闭包的使用场景:
*  函数作为返回值(demo1)
*  函数作为参数传递(demo2)

*题目*

*  说一下对变量提升的理解
  变量定义，函数声明(不是函数表达式)

*  说明this几种不同的使用场景
*  创建10个&lt;a>标签，点击的时候弹出来对应的序号

```javascript
var i,a;
for (i = 0;i < 10;i++) {
  a = document.createElement('a')
  a.innerHTML = i + '<br>'
  a.addEventListener('click', function(e){
    e.preventDefault()
    alert(i)
    })
    document.body.appendChild(a);
}//错误写法

for (i = 0;i < 10;i++) {
  (function(i){
    a = document.createElement('a')
    a.innerHTML = i + '<br>'
    a.addEventListener('click', function(e){
      e.preventDefault()
      alert(i)
    })
    document.body.appendChild(a);
  }(i));//自执行函数，就是不用调用，只要定义完成，立即执行
}
```
*  如何理解作用域

自由变量，作用域链(查找自由变量)， 闭包的两个场景

*  实际开发中闭包的应用
```
//闭包实际应用中主要用于封装变量，收敛权限
function isFirstLoad() {
  var _list = []
  return function (id){
    if(_list.indexOf(id) >= 0){
      return false
    }else{
      _list.push(id)
      return true
    }
  }
}

var firstLoad = isFirstLoad()
firstLoad(10)//true
firstLoad(10)//false
firstLoad(20)//true
```

